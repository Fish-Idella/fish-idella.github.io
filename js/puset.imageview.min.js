!function(t){"use strict";const e="img/loading-w.gif",i="img/pic-error.jpg",n={R_NUMBER:/^.*?(\-?\d+(\.\d+)*).*$/,parse:function(t){return t+"px"},zero:"0px",percent:"100%",negative:"-100%"};function s(t,e){for(let i=0,n=t.length;i<n;i++){let n=t[i];if(n.dataset.index==e)return n}return null}function r(t,e){const i=t.naturalWidth,n=t.naturalHeight;return e>0?n>e?e*i/n:i:0}function a(t,n,s){t.src=e,t.width=800;const a=n[s],l=new Image;l.onerror=function(){t.parentElement.dataset.index==s&&(t.src=i,t.width=919)},l.onload=function(){t.parentElement.dataset.index==s&&(t.loading="eager",t.width=r(l,t.parentElement.clientHeight),t.src=a)},l.src=a}function l(t,e){e.previous&&(e.previous.style.left=n.negative),e.next?(e.next.style.left=n.zero,t.style.left=n.negative,e.updateLayout(e.children,e.next)):t.style.left=n.zero}function o(t,e){e.next&&(e.next.style.left=n.percent),e.previous?(e.previous.style.left=n.zero,t.style.left=n.percent,e.updateLayout(e.children,e.previous)):t.style.left=n.zero}const c=t.createClass({array:null,isEnlarge:!1,currentItem:0,index:0,constructor:function(){this.array=new Array},init:function(t){const e=this.array.length;this.array.splice(0,e,t,t),this.currentItem=t,this.index=1},get:function(t){return this.array[t]||null},ifAdd:function(t){this.isEnlarge?t<this.currentItem&&(this.index++,this.isEnlarge=!1):t>this.currentItem&&(this.index++,this.isEnlarge=!0),this.currentItem=t,this.array[this.index]=t}});t.ImageView=t.createClass({target:null,content:null,header:null,footer:null,previous:null,currentItem:null,next:null,children:null,index:0,max:5,middle:2,data:null,length:0,width:0,height:0,constructor:function(t,e=5){return new h("string"==typeof t?document.querySelector(t):t,+e)},updateLayout:function(t,e){e.style.left=n.zero,this.currentItem=e,this.index=+e.dataset.index;const i=this.index-1;if(this.index>0){this.previous=s(t,i);const e=this.index-this.middle;if(e>=0&&null===s(t,e)){const i=s(t,e+this.max);i.dataset.index=e,a(i.firstChild,this.data,e)}}else this.previous=null;const r=this.index+1;if(r<this.length){this.next=s(t,r);const e=this.index+this.middle;if(e<this.length&&null===s(t,e)){const i=s(t,e-this.max);i.dataset.index=e,a(i.firstChild,this.data,e)}}else this.next=null},toggleActionBar:function(){this.header.classList.toggle("hide"),this.footer.classList.toggle("hide")},bind:function(t){if(Array.isArray(t)){this.data=t,this.length=t.length;const e=this.content.children;t.forEach.call(e,(e,i)=>{e.dataset.index=i,e.classList.remove("transition"),i<this.length?(a(e.firstChild,t,i),e.style.left="100%",e.classList.remove("hide")):e.classList.add("hide")}),this.updateLayout(e,e.item(0))}else this.information.innerHTML='<span class="no-image">没有找到图像资源</span>',this.information.classList.remove("hide");return this},wait:function(){a(this.currentItem.firstChild,[e],0)},init:function(i,s){if(this.data=new Array(0),t.isFunction((this.target=i).querySelector)){const a=this;i.innerHTML='<header></header><section><div class="view content"></div><div id="imgsv" class="view"></div><div id="information" class="view"></div></section><footer></footer>',i.classList.add("image-view");const h=Math.max(5,isNaN(s)?5:s);this.max=h%2==0?h+1:h,this.middle=Math.floor(this.max/2);let d=[`<div style="left: 0px;" data-index="0"><img draggable="false" alt="这是一个看图片的网站" src=${e}></div>`];for(let t=1;t<a.max;t++)d.push(`<div style="left: 100%;" data-index="${t}"><img draggable="false" alt="这是一个看图片的网站" src=${e}></div>`);this.content=i.querySelector("section div.content"),this.content.innerHTML=d.join(""),this.header=i.querySelector("header"),this.footer=i.querySelector("footer"),this.information=i.querySelector("#information"),this.children=a.content.children,this.currentItem=a.children.item(0);const u=function t(){return a.width=a.target.clientWidth,a.height=a.target.clientHeight,t}();window.addEventListener("resize",function(){u();const t=a.currentItem.firstChild;t.width=r(t,a.height)});let f=new c;t(this.content).setManager(function(t){t.get("pan").set({direction:Hammer.DIRECTION_ALL})}).action("tap",function(e){window.requestAnimationFrame(()=>{const i=a.target.clientWidth/3;e.center.x>2*i?(t.each(a.children,t=>t.classList.remove("transition")),l(a.currentItem,a)):e.center.x>i?a.toggleActionBar():(t.each(a.children,t=>t.classList.remove("transition")),o(a.currentItem,a))})}).action("panstart","div",e=>{f.init(e.deltaX),t.each(a.children,t=>t.classList.remove("transition")),u()}).action("pan","div",function(e){const i=e.deltaX;f.ifAdd(i),window.requestAnimationFrame(()=>{if(e.isFinal){if(t.each(a.children,t=>t.classList.add("transition")),Math.abs(i)>30){if(f.isEnlarge&&i>=0)return void o(this,a);if(!f.isEnlarge&&i<=0)return void l(this,a)}!function(t,e){t.style.left=n.zero,e.next&&(e.next.style.left=n.percent),e.previous&&(e.previous.style.left=n.negative)}(this,a)}else{let t=Math.min(a.previous?a.width:50,Math.max(a.next?-a.width:-50,i));a.next&&(a.next.style.left=n.parse(Math.max(0,t+a.width))),a.previous&&(a.previous.style.left=n.parse(Math.min(0,t-a.width))),this.style.left=n.parse(t)}})})}else console.error("`target` is not an instance of Element.");return this}},{clear:function(t){let e;for(;e=t.lastChild;)t.removeChild(e)}});const h=t.ImageView.prototype.init;h.prototype=t.ImageView.prototype}(PuSet);