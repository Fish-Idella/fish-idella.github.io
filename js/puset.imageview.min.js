!function(t){"use strict";const e="img/loading.webp",i="img/error.png",n={R_NUMBER:/^.*?(\-?\d+(\.\d+)*).*$/,parse:function(t){return t+"px"},zero:"0px",percent:"100%",negative:"-100%"};function s(t,e){for(let i=0,n=t.length;i<n;i++){let n=t[i];if(n.dataset.index==e)return n}return null}function r(t,e){const i=t.naturalWidth,n=t.naturalHeight;return e>0?n>e?e*i/n:i:0}function o(t,n,s){if(t.src=e,t.width=800,n&&n.item){const e=n.item(s),o=e.dataset.src,a=new Image;a.onerror=function(){t.parentElement.dataset.index==s&&(t.width=280,t.src=i)},a.onload=function(){e.dataset.src===o&&(e.src=o),t.parentElement.dataset.index==s&&(t.width=r(a,t.parentElement.clientHeight),t.src=o)},a.src=o}}function a(t,e){t.style.left=e}function c(t,e){t&&a(t,e)}function l(t,e){c(e.previous,n.negative),e.next?(a(e.next,n.zero),a(t,n.negative),e.updateLayout(e.children,e.next)):a(t,n.zero)}function h(t,e){c(e.next,n.percent),e.previous?(a(e.previous,n.zero),a(t,n.percent),e.updateLayout(e.children,e.previous)):a(t,n.zero)}const d=t.createClass({array:null,enlarge:!1,current:0,index:0,constructor:function(){this.array=new Array},init:function(t){const e=this.array.length;this.array.splice(0,e,t,t),this.enlarge=0,this.current=t,this.index=1},get:function(t){const e=this.array;return t<0?e[t+e.length]:e[t]},getRange:function(t,e){return this.get(isNaN(e)?this.index:e)-this.get(isNaN(t)?0:t)},addIf:function(t){const e=t-this.current;(this.enlarge>0&&e<0||this.enlarge<0&&e>0)&&this.index++,this.current=t,this.array[this.index]=t,this.enlarge=this.getRange(-2,-1)}});t.ImageView=t.createClass({target:null,content_horizontal:null,header:null,footer:null,previous:null,current:null,next:null,children:null,lastString:"",toastId:0,toast_content:null,toast_view:null,content_vertical:null,information:null,index:0,max:5,middle:2,data:null,length:0,width:0,height:0,constructor:function(t,e=5){return new u("string"==typeof t?document.querySelector(t):t,+e)},updateLayout:function(t,e){a(e,n.zero),this.current=e,this.index=+e.dataset.index,this.toast(`第 ${1+this.index} 张`,500);const i=this.content_vertical.children,r=this.index-1;if(this.index>0){this.previous=s(t,r);const e=this.index-this.middle;if(e>=0&&null===s(t,e)){const n=s(t,e+this.max);n.dataset.index=e,o(n.firstChild,i,e)}}else this.previous=null;const c=this.index+1;if(c<this.length){this.next=s(t,c);const e=this.index+this.middle;if(e<this.length&&null===s(t,e)){const n=s(t,e-this.max);n.dataset.index=e,o(n.firstChild,i,e)}}else this.next=null},toggleActionBar:function(){this.header.classList.toggle("hide"),this.footer.classList.toggle("hide")},bind:function(t){if(Array.isArray(t)){this.data=t,this.length=t.length;const e=this.content_horizontal.children,i=this.content_vertical.children,s=Math.max(this.length,this.max,i.length);let r;for(let c=0;c<s;c++)r=this.getVerticalItem(c),c<this.length?(r.dataset.src=t[c],r.classList.remove("hide")):r.classList.add("hide"),c<this.max&&((r=e.item(c)).dataset.index=c,r.classList.remove("transition"),c<this.length?(o(r.firstChild,i,c),a(r,n.percent),r.classList.remove("hide")):r.classList.add("hide"));this.updateLayout(e,e.item(0))}else this.information.classList.remove("hide");return this},wait:function(){this.or?o(this.current.firstChild,null,0):t.each(this.content_vertical.children,t=>t.src="img/loading.gif")},getVerticalItem:function(t){let e;return this.content_vertical&&null===(e=this.content_vertical.children.item(t))&&((e=new Image).alt="这是一个看图片的网站",this.content_vertical.appendChild(e)),e.src="img/loading.gif",e},toast:function(t,e=1e3){const i=this,s=Date.now();if(t===i.lastString&&s-i.toastId<e)return;const r=i.toast_view;i.toast_content.innerHTML="<span>"+(""+(i.lastString=t)).replace(/\</g,"&lt;")+"</span>",function(t,e,i,n,s){"function"==typeof i&&([t,e,n,s]=arguments),0===t&&requestAnimationFrame(()=>void n(e,i));let r=void 0,o=0;const a=e/t,c="function"!=typeof s;requestAnimationFrame(function t(l){void 0===r&&(r=l);const h=l-r;if(o===e){if(c)return;if(!1===s(h,i))return}else if(!1===n(o=Math.min(e,h*a),i))return;requestAnimationFrame(t)})}(150,200,i.toastId=s,function(t){r.style.bottom=n.parse(t-140)},function(t,s){return i.toastId==s&&(t>e?(r.style.bottom=n.negative,!1):void 0)})},init:function(i,s){if(this.data=new Array(0),t.isFunction((this.target=i).querySelector)){const o=this;let u,f;const g=i.querySelector(".header"),m=i.querySelector(".footer");g&&(f=document.importNode(g.content,!0)),m&&(u=document.importNode(m.content,!0)),i.innerHTML='<header class="image-box hide"></header><section><div class="view horizontal content"></div><div class="view vertical content hide"></div><div class="view information content hide"></div><table class="toast"><tbody><tr><td class="toast-content"></td></tr></tbody></table></section><footer class="image-box hide"></footer>',i.classList.add("image-view");const v=Math.max(5,isNaN(s)?5:s);this.max=v%2==0?v+1:v,this.middle=Math.floor(this.max/2);const p=[`<div style="left: 0px;" data-index="0"><img draggable="false" alt="这是一个看图片的网站" src=${e}></div>`];for(let t=1;t<o.max;t++)p.push(`<div style="left: 100%;" data-index="${t}"><img draggable="false" alt="这是一个看图片的网站" src=${e}></div>`);this.content_horizontal=i.querySelector("section div.horizontal.content"),this.content_horizontal.innerHTML=p.join(""),this.header=i.querySelector("header"),this.footer=i.querySelector("footer"),g&&this.header.appendChild(f),m&&this.footer.appendChild(u),this.information=i.querySelector(".information"),this.toast_view=i.querySelector(".toast"),this.toast_content=this.toast_view.querySelector(".toast-content"),this.children=o.content_horizontal.children,this.current=o.children.item(0),this.content_vertical=i.querySelector(".vertical.content");const x=function t(){return o.width=o.target.clientWidth,o.height=o.target.clientHeight,t}();this.footer.addEventListener("click",function(){o.header.classList.add("hide"),o.footer.classList.add("hide")}),window.addEventListener("resize",function(){x();const t=o.current.firstChild;t.width=r(t,o.height)});let y=new d;t(this.content_horizontal).setManager(function(t){t.get("pan").set({direction:Hammer.DIRECTION_ALL})}).action("tap",function(e){window.requestAnimationFrame(()=>{const i=o.target.clientWidth/3;e.center.x>2*i?(t.each(o.children,t=>t.classList.remove("transition")),o.next?l(o.current,o):o.toast("已是最后一张")):e.center.x>i?o.toggleActionBar():(t.each(o.children,t=>t.classList.remove("transition")),o.previous?h(o.current,o):o.toast("已是第一张"))})}).action("panstart","div",e=>{y.init(e.deltaX),t.each(o.children,t=>t.classList.remove("transition")),x()}).action("pan","div",function(e){const i=e.deltaX;y.addIf(i),window.requestAnimationFrame(()=>{if(e.isFinal){t.each(o.children,t=>t.classList.add("transition"));const e=y.enlarge,s=Math.abs(i),r=Math.abs(e);if(s>20&&e>0&&i>0||e<0&&r<20)return void h(this,o);if(s>20&&e<0&&i<0||e>0&&r<20)return void l(this,o);!function(t,e){a(t,n.zero),c(e.next,n.percent),c(e.previous,n.negative)}(this,o)}else{const t=Math.min(o.previous?o.width:50,Math.max(o.next?-o.width:-50,i));c(o.next,n.parse(Math.max(0,t+o.width))),c(o.previous,n.parse(Math.min(0,t-o.width))),a(this,n.parse(t))}})})}else console.error("`target` is not an instance of Element.");return this}},{clear:function(t){let e;for(;e=t.lastChild;)t.removeChild(e)}});const u=t.ImageView.prototype.init;u.prototype=t.ImageView.prototype}(PuSet);