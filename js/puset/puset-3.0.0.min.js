"use strict";

function _regeneratorRuntime() {
    "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
    _regeneratorRuntime = function _regeneratorRuntime() {
        return exports;
    };
    var exports = {},
        Op = Object.prototype,
        hasOwn = Op.hasOwnProperty,
        defineProperty = Object.defineProperty || function (obj, key, desc) {
            obj[key] = desc.value;
        },
        $Symbol = "function" == typeof Symbol ? Symbol : {},
        iteratorSymbol = $Symbol.iterator || "@@iterator",
        asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator",
        toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

    function define(obj, key, value) {
        return Object.defineProperty(obj, key, {
            value: value,
            enumerable: !0,
            configurable: !0,
            writable: !0
        }), obj[key];
    }
    try {
        define({}, "");
    } catch (err) {
        define = function define(obj, key, value) {
            return obj[key] = value;
        };
    }

    function wrap(innerFn, outerFn, self, tryLocsList) {
        var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,
            generator = Object.create(protoGenerator.prototype),
            context = new Context(tryLocsList || []);
        return defineProperty(generator, "_invoke", {
            value: makeInvokeMethod(innerFn, self, context)
        }), generator;
    }

    function tryCatch(fn, obj, arg) {
        try {
            return {
                type: "normal",
                arg: fn.call(obj, arg)
            };
        } catch (err) {
            return {
                type: "throw",
                arg: err
            };
        }
    }
    exports.wrap = wrap;
    var ContinueSentinel = {};

    function Generator() { }

    function GeneratorFunction() { }

    function GeneratorFunctionPrototype() { }
    var IteratorPrototype = {};
    define(IteratorPrototype, iteratorSymbol, function () {
        return this;
    });
    var getProto = Object.getPrototypeOf,
        NativeIteratorPrototype = getProto && getProto(getProto(values([])));
    NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);
    var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);

    function defineIteratorMethods(prototype) {
        ["next", "throw", "return"].forEach(function (method) {
            define(prototype, method, function (arg) {
                return this._invoke(method, arg);
            });
        });
    }

    function AsyncIterator(generator, PromiseImpl) {
        function invoke(method, arg, resolve, reject) {
            var record = tryCatch(generator[method], generator, arg);
            if ("throw" !== record.type) {
                var result = record.arg,
                    value = result.value;
                return value && "object" == _typeof(value) && hasOwn.call(value, "__await") ? PromiseImpl.resolve(value.__await).then(function (value) {
                    invoke("next", value, resolve, reject);
                }, function (err) {
                    invoke("throw", err, resolve, reject);
                }) : PromiseImpl.resolve(value).then(function (unwrapped) {
                    result.value = unwrapped, resolve(result);
                }, function (error) {
                    return invoke("throw", error, resolve, reject);
                });
            }
            reject(record.arg);
        }
        var previousPromise;
        defineProperty(this, "_invoke", {
            value: function value(method, arg) {
                function callInvokeWithMethodAndArg() {
                    return new PromiseImpl(function (resolve, reject) {
                        invoke(method, arg, resolve, reject);
                    });
                }
                return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();
            }
        });
    }

    function makeInvokeMethod(innerFn, self, context) {
        var state = "suspendedStart";
        return function (method, arg) {
            if ("executing" === state) throw new Error("Generator is already running");
            if ("completed" === state) {
                if ("throw" === method) throw arg;
                return doneResult();
            }
            for (context.method = method, context.arg = arg; ;) {
                var delegate = context.delegate;
                if (delegate) {
                    var delegateResult = maybeInvokeDelegate(delegate, context);
                    if (delegateResult) {
                        if (delegateResult === ContinueSentinel) continue;
                        return delegateResult;
                    }
                }
                if ("next" === context.method) context.sent = context._sent = context.arg;
                else if ("throw" === context.method) {
                    if ("suspendedStart" === state) throw state = "completed", context.arg;
                    context.dispatchException(context.arg);
                } else "return" === context.method && context.abrupt("return", context.arg);
                state = "executing";
                var record = tryCatch(innerFn, self, context);
                if ("normal" === record.type) {
                    if (state = context.done ? "completed" : "suspendedYield", record.arg === ContinueSentinel) continue;
                    return {
                        value: record.arg,
                        done: context.done
                    };
                }
                "throw" === record.type && (state = "completed", context.method = "throw", context.arg = record.arg);
            }
        };
    }

    function maybeInvokeDelegate(delegate, context) {
        var methodName = context.method,
            method = delegate.iterator[methodName];
        if (undefined === method) return context.delegate = null, "throw" === methodName && delegate.iterator["return"] && (context.method = "return", context.arg = undefined, maybeInvokeDelegate(delegate, context), "throw" === context.method) || "return" !== methodName && (context.method = "throw", context.arg = new TypeError("The iterator does not provide a '" + methodName + "' method")), ContinueSentinel;
        var record = tryCatch(method, delegate.iterator, context.arg);
        if ("throw" === record.type) return context.method = "throw", context.arg = record.arg, context.delegate = null, ContinueSentinel;
        var info = record.arg;
        return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, "return" !== context.method && (context.method = "next", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = "throw", context.arg = new TypeError("iterator result is not an object"), context.delegate = null, ContinueSentinel);
    }

    function pushTryEntry(locs) {
        var entry = {
            tryLoc: locs[0]
        };
        1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);
    }

    function resetTryEntry(entry) {
        var record = entry.completion || {};
        record.type = "normal", delete record.arg, entry.completion = record;
    }

    function Context(tryLocsList) {
        this.tryEntries = [{
            tryLoc: "root"
        }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);
    }

    function values(iterable) {
        if (iterable) {
            var iteratorMethod = iterable[iteratorSymbol];
            if (iteratorMethod) return iteratorMethod.call(iterable);
            if ("function" == typeof iterable.next) return iterable;
            if (!isNaN(iterable.length)) {
                var i = -1,
                    next = function next() {
                        for (; ++i < iterable.length;)
                            if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;
                        return next.value = undefined, next.done = !0, next;
                    };
                return next.next = next;
            }
        }
        return {
            next: doneResult
        };
    }

    function doneResult() {
        return {
            value: undefined,
            done: !0
        };
    }
    return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, "constructor", {
        value: GeneratorFunctionPrototype,
        configurable: !0
    }), defineProperty(GeneratorFunctionPrototype, "constructor", {
        value: GeneratorFunction,
        configurable: !0
    }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, "GeneratorFunction"), exports.isGeneratorFunction = function (genFun) {
        var ctor = "function" == typeof genFun && genFun.constructor;
        return !!ctor && (ctor === GeneratorFunction || "GeneratorFunction" === (ctor.displayName || ctor.name));
    }, exports.mark = function (genFun) {
        return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, "GeneratorFunction")), genFun.prototype = Object.create(Gp), genFun;
    }, exports.awrap = function (arg) {
        return {
            __await: arg
        };
    }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {
        return this;
    }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {
        void 0 === PromiseImpl && (PromiseImpl = Promise);
        var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);
        return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {
            return result.done ? result.value : iter.next();
        });
    }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, "Generator"), define(Gp, iteratorSymbol, function () {
        return this;
    }), define(Gp, "toString", function () {
        return "[object Generator]";
    }), exports.keys = function (val) {
        var object = Object(val),
            keys = [];
        for (var key in object) keys.push(key);
        return keys.reverse(),
            function next() {
                for (; keys.length;) {
                    var key = keys.pop();
                    if (key in object) return next.value = key, next.done = !1, next;
                }
                return next.done = !0, next;
            };
    }, exports.values = values, Context.prototype = {
        constructor: Context,
        reset: function reset(skipTempReset) {
            if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = "next", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset)
                for (var name in this) "t" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);
        },
        stop: function stop() {
            this.done = !0;
            var rootRecord = this.tryEntries[0].completion;
            if ("throw" === rootRecord.type) throw rootRecord.arg;
            return this.rval;
        },
        dispatchException: function dispatchException(exception) {
            if (this.done) throw exception;
            var context = this;

            function handle(loc, caught) {
                return record.type = "throw", record.arg = exception, context.next = loc, caught && (context.method = "next", context.arg = undefined), !!caught;
            }
            for (var i = this.tryEntries.length - 1; i >= 0; --i) {
                var entry = this.tryEntries[i],
                    record = entry.completion;
                if ("root" === entry.tryLoc) return handle("end");
                if (entry.tryLoc <= this.prev) {
                    var hasCatch = hasOwn.call(entry, "catchLoc"),
                        hasFinally = hasOwn.call(entry, "finallyLoc");
                    if (hasCatch && hasFinally) {
                        if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);
                        if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);
                    } else if (hasCatch) {
                        if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);
                    } else {
                        if (!hasFinally) throw new Error("try statement without catch or finally");
                        if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);
                    }
                }
            }
        },
        abrupt: function abrupt(type, arg) {
            for (var i = this.tryEntries.length - 1; i >= 0; --i) {
                var entry = this.tryEntries[i];
                if (entry.tryLoc <= this.prev && hasOwn.call(entry, "finallyLoc") && this.prev < entry.finallyLoc) {
                    var finallyEntry = entry;
                    break;
                }
            }
            finallyEntry && ("break" === type || "continue" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);
            var record = finallyEntry ? finallyEntry.completion : {};
            return record.type = type, record.arg = arg, finallyEntry ? (this.method = "next", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);
        },
        complete: function complete(record, afterLoc) {
            if ("throw" === record.type) throw record.arg;
            return "break" === record.type || "continue" === record.type ? this.next = record.arg : "return" === record.type ? (this.rval = this.arg = record.arg, this.method = "return", this.next = "end") : "normal" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;
        },
        finish: function finish(finallyLoc) {
            for (var i = this.tryEntries.length - 1; i >= 0; --i) {
                var entry = this.tryEntries[i];
                if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;
            }
        },
        "catch": function _catch(tryLoc) {
            for (var i = this.tryEntries.length - 1; i >= 0; --i) {
                var entry = this.tryEntries[i];
                if (entry.tryLoc === tryLoc) {
                    var record = entry.completion;
                    if ("throw" === record.type) {
                        var thrown = record.arg;
                        resetTryEntry(entry);
                    }
                    return thrown;
                }
            }
            throw new Error("illegal catch attempt");
        },
        delegateYield: function delegateYield(iterable, resultName, nextLoc) {
            return this.delegate = {
                iterator: values(iterable),
                resultName: resultName,
                nextLoc: nextLoc
            }, "next" === this.method && (this.arg = undefined), ContinueSentinel;
        }
    }, exports;
}

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}

function _asyncToGenerator(fn) {
    return function () {
        var self = this,
            args = arguments;
        return new Promise(function (resolve, reject) {
            var gen = fn.apply(self, args);

            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }

            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}

function _classPrivateMethodInitSpec(obj, privateSet) {
    _checkPrivateRedeclaration(obj, privateSet);
    privateSet.add(obj);
}

function _classPrivateFieldInitSpec(obj, privateMap, value) {
    _checkPrivateRedeclaration(obj, privateMap);
    privateMap.set(obj, value);
}

function _checkPrivateRedeclaration(obj, privateCollection) {
    if (privateCollection.has(obj)) {
        throw new TypeError("Cannot initialize the same private elements twice on an object");
    }
}

function _classPrivateFieldSet(receiver, privateMap, value) {
    var descriptor = _classExtractFieldDescriptor(receiver, privateMap, "set");
    _classApplyDescriptorSet(receiver, descriptor, value);
    return value;
}

function _classApplyDescriptorSet(receiver, descriptor, value) {
    if (descriptor.set) {
        descriptor.set.call(receiver, value);
    } else {
        if (!descriptor.writable) {
            throw new TypeError("attempted to set read only private field");
        }
        descriptor.value = value;
    }
}

function _classPrivateFieldGet(receiver, privateMap) {
    var descriptor = _classExtractFieldDescriptor(receiver, privateMap, "get");
    return _classApplyDescriptorGet(receiver, descriptor);
}

function _classExtractFieldDescriptor(receiver, privateMap, action) {
    if (!privateMap.has(receiver)) {
        throw new TypeError("attempted to " + action + " private field on non-instance");
    }
    return privateMap.get(receiver);
}

function _classApplyDescriptorGet(receiver, descriptor) {
    if (descriptor.get) {
        return descriptor.get.call(receiver);
    }
    return descriptor.value;
}

function _classPrivateMethodGet(receiver, privateSet, fn) {
    if (!privateSet.has(receiver)) {
        throw new TypeError("attempted to get private field on non-instance");
    }
    return fn;
}

function _slicedToArray(arr, i) {
    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}

function _nonIterableRest() {
    throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

function _iterableToArrayLimit(arr, i) {
    var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];
    if (null != _i) {
        var _s, _e, _x, _r, _arr = [],
            _n = !0,
            _d = !1;
        try {
            if (_x = (_i = _i.call(arr)).next, 0 === i) {
                if (Object(_i) !== _i) return;
                _n = !1;
            } else
                for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);
        } catch (err) {
            _d = !0, _e = err;
        } finally {
            try {
                if (!_n && null != _i["return"] && (_r = _i["return"](), Object(_r) !== _r)) return;
            } finally {
                if (_d) throw _e;
            }
        }
        return _arr;
    }
}

function _arrayWithHoles(arr) {
    if (Array.isArray(arr)) return arr;
}

function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}

function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}

function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);
    }
}

function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    Object.defineProperty(Constructor, "prototype", {
        writable: false
    });
    return Constructor;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function");
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, {
        constructor: {
            value: subClass,
            writable: true,
            configurable: true
        }
    });
    Object.defineProperty(subClass, "prototype", {
        writable: false
    });
    if (superClass) _setPrototypeOf(subClass, superClass);
}

function _createSuper(Derived) {
    var hasNativeReflectConstruct = _isNativeReflectConstruct();
    return function _createSuperInternal() {
        var Super = _getPrototypeOf(Derived),
            result;
        if (hasNativeReflectConstruct) {
            var NewTarget = _getPrototypeOf(this).constructor;
            result = Reflect.construct(Super, arguments, NewTarget);
        } else {
            result = Super.apply(this, arguments);
        }
        return _possibleConstructorReturn(this, result);
    };
}

function _possibleConstructorReturn(self, call) {
    if (call && (_typeof(call) === "object" || typeof call === "function")) {
        return call;
    } else if (call !== void 0) {
        throw new TypeError("Derived constructors may only return object or undefined");
    }
    return _assertThisInitialized(self);
}

function _assertThisInitialized(self) {
    if (self === void 0) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }
    return self;
}

function _wrapNativeSuper(Class) {
    var _cache = typeof Map === "function" ? new Map() : undefined;
    _wrapNativeSuper = function _wrapNativeSuper(Class) {
        if (Class === null || !_isNativeFunction(Class)) return Class;
        if (typeof Class !== "function") {
            throw new TypeError("Super expression must either be null or a function");
        }
        if (typeof _cache !== "undefined") {
            if (_cache.has(Class)) return _cache.get(Class);
            _cache.set(Class, Wrapper);
        }

        function Wrapper() {
            return _construct(Class, arguments, _getPrototypeOf(this).constructor);
        }
        Wrapper.prototype = Object.create(Class.prototype, {
            constructor: {
                value: Wrapper,
                enumerable: false,
                writable: true,
                configurable: true
            }
        });
        return _setPrototypeOf(Wrapper, Class);
    };
    return _wrapNativeSuper(Class);
}

function _construct(Parent, args, Class) {
    if (_isNativeReflectConstruct()) {
        _construct = Reflect.construct.bind();
    } else {
        _construct = function _construct(Parent, args, Class) {
            var a = [null];
            a.push.apply(a, args);
            var Constructor = Function.bind.apply(Parent, a);
            var instance = new Constructor();
            if (Class) _setPrototypeOf(instance, Class.prototype);
            return instance;
        };
    }
    return _construct.apply(null, arguments);
}

function _isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;
    try {
        Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () { }));
        return true;
    } catch (e) {
        return false;
    }
}

function _isNativeFunction(fn) {
    return Function.toString.call(fn).indexOf("[native code]") !== -1;
}

function _setPrototypeOf(o, p) {
    _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {
        o.__proto__ = p;
        return o;
    };
    return _setPrototypeOf(o, p);
}

function _getPrototypeOf(o) {
    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {
        return o.__proto__ || Object.getPrototypeOf(o);
    };
    return _getPrototypeOf(o);
}

function _defineProperty(obj, key, value) {
    key = _toPropertyKey(key);
    if (key in obj) {
        Object.defineProperty(obj, key, {
            value: value,
            enumerable: true,
            configurable: true,
            writable: true
        });
    } else {
        obj[key] = value;
    }
    return obj;
}

function _toPropertyKey(arg) {
    var key = _toPrimitive(arg, "string");
    return _typeof(key) === "symbol" ? key : String(key);
}

function _toPrimitive(input, hint) {
    if (_typeof(input) !== "object" || input === null) return input;
    var prim = input[Symbol.toPrimitive];
    if (prim !== undefined) {
        var res = prim.call(input, hint || "default");
        if (_typeof(res) !== "object") return res;
        throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return (hint === "string" ? String : Number)(input);
}

function _typeof(obj) {
    "@babel/helpers - typeof";
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {
        return typeof obj;
    } : function (obj) {
        return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    }, _typeof(obj);
}

function _createForOfIteratorHelper(o, allowArrayLike) {
    var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];
    if (!it) {
        if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
            if (it) o = it;
            var i = 0;
            var F = function F() { };
            return {
                s: F,
                n: function n() {
                    if (i >= o.length) return {
                        done: true
                    };
                    return {
                        done: false,
                        value: o[i++]
                    };
                },
                e: function e(_e2) {
                    throw _e2;
                },
                f: F
            };
        }
        throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }
    var normalCompletion = true,
        didErr = false,
        err;
    return {
        s: function s() {
            it = it.call(o);
        },
        n: function n() {
            var step = it.next();
            normalCompletion = step.done;
            return step;
        },
        e: function e(_e3) {
            didErr = true;
            err = _e3;
        },
        f: function f() {
            try {
                if (!normalCompletion && it["return"] != null) it["return"]();
            } finally {
                if (didErr) throw err;
            }
        }
    };
}

function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(o);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];
    return arr2;
}

var PuSet = function () {
    "use strict";

    // 版本信息
    var version = "3.0.0";

    // 缓存常用引用
    var document = window.document;
    var HIDE_ATTRIBUTE = "v-hide"; // 用于隐藏元素的属性名
    var LENGTH_PROPERTY = "length"; // 数组长度属性名

    /**
     * 初始化隐藏元素的样式
     * 添加全局样式规则，使带有v-hide属性的元素隐藏
     */
    if (document.querySelector("head>style.v-hide") === null) {
        var styleElement = document.createElement("style");
        styleElement.className = HIDE_ATTRIBUTE;
        styleElement.innerHTML = ".hide, [".concat(HIDE_ATTRIBUTE, "] {display: none !important;}");
        document.head.appendChild(styleElement);
    }
    var indexOf = Array.prototype.indexOf;
    var slice = Array.prototype.slice;
    var push = Array.prototype.push;
    var toString = Object.prototype.toString;
    var getProto = Object.getPrototypeOf;
    var hasOwn = Object.prototype.hasOwnProperty;
    var fnToString = hasOwn.toString;
    var ObjectFunctionString = fnToString.call(Object);
    var rhtmlSuffix = /HTML$/i;
    var returnTrue = function returnTrue() {
        return true;
    };
    var returnFalse = function returnFalse() {
        return false;
    };

    // 类型映射表 - 创建类型检测工具
    var TYPES = new function Types() {
        var s = "Boolean Number String Function Array Date RegExp Object Error Symbol BigInt Map Promise Set".split(" ");
        var _iterator = _createForOfIteratorHelper(s),
            _step;
        try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
                var value = _step.value;
                // 同时设置简写和完整类型名称的映射
                this["[object ".concat(value, "]")] = this[value] = value.toLowerCase();
            }
        } catch (err) {
            _iterator.e(err);
        } finally {
            _iterator.f();
        }
    }();

    // 函数类型检测（排除DOM节点和HTML集合）
    var isFunction = function isFunction(obj) {
        return TYPES.Function === _typeof(obj) && TYPES.Number !== _typeof(obj.nodeType) && TYPES.Function !== _typeof(obj.item);
    };

    // 窗口对象检测
    var isWindow = function isWindow(obj) {
        return obj != null && obj === obj.window;
    };

    // 精确类型检测函数
    var toType = function toType(test) {
        // 处理 null 和 undefined
        if (null == test) return String(test);
        var type = _typeof(test);
        // 对象和函数需要进一步检测具体类型
        if (type === TYPES.Object || type === TYPES.Function) {
            var key = toString.call(test);
            return TYPES.hasOwnProperty(key) ? TYPES[key] : TYPES.Object;
        }
        return type;
    };

    // 类数组对象检测
    var isArrayLike = function isArrayLike(obj) {
        // 如果是数组直接返回true
        if (PuSetFactory.isArray(obj)) {
            return true;
        }
        var length = !!obj && LENGTH_PROPERTY in obj && obj.length;
        var type = toType(obj);

        // 排除函数和窗口对象
        if (isFunction(obj) || isWindow(obj)) {
            return false;
        }

        // 检测是否为类数组结构
        return type === "array" || length === 0 || TYPES.Number === _typeof(length) && length > 0 && length - 1 in obj;
    };

    // 核心节点列表类，继承自Array
    // ES2015+
    var PuSetConstructor = /*#__PURE__*/ function (_Array) {
        _inherits(PuSet, _Array);
        var _super = _createSuper(PuSet);

        function PuSet() {
            var _this;
            _classCallCheck(this, PuSet);
            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
            }
            _this = _super.call.apply(_super, [this].concat(args));
            _defineProperty(_assertThisInitialized(_this), "prevObject", null);
            _this.prevObject = null;
            return _this;
        }

        // 创建空实例的静态方法
        _createClass(PuSet, [{
            key: "ready",
            value:
                // DOM就绪回调方法
                function ready(fn) {
                    readyPromise.then(function () {
                        return fn(PuSetFactory);
                    })["catch"](console.error);
                    return this;
                }

            // 堆栈管理：保存当前选择集并返回新选择集
        }, {
            key: "pushStack",
            value: function pushStack(elems) {
                var ret = PuSetFactory.merge(PuSetConstructor.newInstance(), elems);
                // 保存前一个对象引用，支持链式操作的回溯
                ret.prevObject = this;
                return ret;
            }
        }, {
            key: "even",
            value: function even() {
                return this.pushStack(PuSetFactory.grep(this, function (_elem, i) {
                    return (i + 1) % 2;
                }));
            }
        }, {
            key: "odd",
            value: function odd() {
                return this.pushStack(PuSetFactory.grep(this, function (_elem, i) {
                    return i % 2;
                }));
            }
        }, {
            key: "eq",
            value: function eq(i) {
                var len = this.length,
                    j = +i + (i < 0 ? len : 0);
                return this.pushStack(j >= 0 && j < len ? [this[j]] : []);
            }
        }, {
            key: "add",
            value: function add(selector, context) {
                return this.pushStack(PuSetFactory.uniqueSort(PuSetFactory.merge(this.slice(), PuSetFactory(selector, context))));
            }

            // 查找后代元素
        }, {
            key: "find",
            value: function find(selector) {
                var arr = this.pushStack([]);
                if (selector && TYPES.String === _typeof(selector)) {
                    // 合并查询结果
                    var _iterator2 = _createForOfIteratorHelper(this),
                        _step2;
                    try {
                        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                            var target = _step2.value;
                            arr.push.apply(arr, _toConsumableArray(target.querySelectorAll(selector)));
                        }
                    } catch (err) {
                        _iterator2.e(err);
                    } finally {
                        _iterator2.f();
                    }
                }
                return this.length > 1 ? PuSetFactory.uniqueSort(arr) : arr;
            }

            // 返回到前一个选择集
        }, {
            key: "end",
            value: function end() {
                return this.prevObject || PuSetConstructor.newInstance();
            }

            // 过滤当前选择集
        }, {
            key: "filter",
            value: function filter(selector) {
                return this.pushStack(winnow(this, selector || [], false));
            }

            // 排除匹配元素
        }, {
            key: "not",
            value: function not(selector) {
                return this.pushStack(winnow(this, selector || [], true));
            }

            // 检测当前选择集是否匹配选择器
        }, {
            key: "is",
            value: function is(selector) {
                return !!winnow(this, selector || [], false).length;
            }
        }], [{
            key: "newInstance",
            value: function newInstance() {
                return new PuSetConstructor();
            }
        }]);
        return PuSet;
    }( /*#__PURE__*/ _wrapNativeSuper(Array));

    // 根选择集（document）
    var rootPuSet = new PuSetConstructor(document);

    // 过滤函数：统一处理filter和not的逻辑
    var winnow = function winnow(elements, qualifier, not) {
        // 函数选择器处理
        if (isFunction(qualifier)) {
            return PuSetFactory.grep(elements, function (elem, i) {
                return !!qualifier.call(elem, i, elem);
            }, not);
        }

        // 单个DOM元素匹配
        if (qualifier.nodeType) {
            return PuSetFactory.grep(elements, function (elem) {
                return elem === qualifier;
            }, not);
        }

        // 元素数组匹配
        if (TYPES.String !== _typeof(qualifier)) {
            return PuSetFactory.grep(elements, function (elem) {
                return indexOf.call(qualifier, elem) > -1;
            }, not);
        }

        // 选择器字符串匹配
        var selector = rootPuSet.find(qualifier);
        return PuSetFactory.grep(elements, function (element) {
            return selector.indexOf(element, 0) >= 0;
        }, not);
    };
    var compareDocumentPositionSort = function compareDocumentPositionSort(a, b) {
        // Sort on method existence if only one input has compareDocumentPosition
        var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
        if (compare) {
            return compare;
        }
        return a.compareDocumentPosition(b) & Node.DOCUMENT_POSITION_FOLLOWING ? -1 : 1;
    };

    // 主函数定义
    var PuSetFactory = Object.assign(function PuSet(selector, context) {
        // 处理空选择器
        if (!selector) {
            return PuSetConstructor.newInstance();
        }

        // 单个DOM元素：直接包装
        if (selector.nodeType) {
            return new PuSetConstructor(selector);
        }

        // 字符串选择器：查询DOM
        if (TYPES.String === _typeof(selector)) {
            if (context) {
                if (context.constructor === PuSetConstructor) {
                    return context.find(selector);
                } else {
                    return PuSetFactory(context).find(selector);
                }
            } else {
                return rootPuSet.find(selector);
            }
        }

        // 函数选择器：DOM就绪回调
        if (isFunction(selector)) {
            return rootPuSet.ready(selector);
        }

        // 其他类型：转换为数组形式
        return PuSetFactory.makeArray(selector, PuSetConstructor.newInstance());
    }, {
        // 静态属性：版本号
        version: version,
        // 就绪状态标志
        isReady: returnFalse,
        isFunction: isFunction,
        isWindow: isWindow,
        // 数组检测（兼容老版本浏览器）
        isArray: Array.isArray || function (obj) {
            return TYPES.Array === toType(obj);
        },
        isXMLDoc: function isXMLDoc(elem) {
            var namespace = elem && elem.namespaceURI,
                docElem = elem && (elem.ownerDocument || elem).documentElement;

            // Assume HTML when documentElement doesn"t yet exist, such as inside
            // document fragments.
            return !rhtmlSuffix.test(namespace || docElem && docElem.nodeName || "HTML");
        },
        isNumeric: function isNumeric(obj) {
            // As of jQuery 3.0, isNumeric is limited to
            // strings and numbers (primitives or objects)
            // that can be coerced to finite numbers (gh-2662)
            var type = toType(obj);
            return (type === TYPES.Number || type === TYPES.String) &&
                // parseFloat NaNs numeric-cast false positives ("")
                // ...but misinterprets leading-number strings, particularly hex literals ("0x...")
                // subtraction forces infinities to NaN
                !isNaN(obj - parseFloat(obj));
        },
        isPlainObject: function isPlainObject(obj) {
            var proto, Ctor;

            // Detect obvious negatives
            // Use toString instead of jQuery.type to catch host objects
            if (!obj || toString.call(obj) !== "[object Object]") {
                return false;
            }
            proto = getProto(obj);

            // Objects with no prototype (e.g., `Object.create( null )`) are plain
            if (!proto) {
                return true;
            }

            // Objects with prototype are plain iff they were constructed by a global Object function
            Ctor = hasOwn.call(proto, "constructor") && proto.constructor;
            return TYPES.Function === _typeof(Ctor) && ObjectFunctionString === fnToString.call(Ctor);
        },
        isEmptyObject: function isEmptyObject(obj) {
            for (var name in obj) {
                return false;
            }
            return true;
        },
        /**
         * 显示/隐藏元素
         * @param {Element} targetElement - 目标元素
         * @param {boolean} value - true显示，false隐藏
         */
        show: function show(targetElement, value) {
            if (value) {
                targetElement.removeAttribute(HIDE_ATTRIBUTE); // 移除隐藏属性
                targetElement.classList.remove("hide");
            } else {
                targetElement.setAttribute(HIDE_ATTRIBUTE, HIDE_ATTRIBUTE); // 添加隐藏属性
                targetElement.classList.add("hide");
            }
            return targetElement;
        },
        uniqueSort: function uniqueSort(results) {
            var duplicates = [];
            var hasDuplicate = false;
            var i = 0,
                j = 0;
            var elem;
            duplicates.sort.call(results, function (a, b) {
                if (a === b) {
                    hasDuplicate = true;
                    return 0;
                }
                return compareDocumentPositionSort(a, b);
            });
            if (hasDuplicate) {
                while (elem = results[i++]) {
                    if (elem === results[i]) {
                        j = duplicates.push(i);
                    }
                }
                while (j--) {
                    duplicates.splice.call(results, duplicates[j], 1);
                }
            }
            return results;
        },
        // 数组合并方法（兼容类数组对象）
        merge: function merge(first, second) {
            var len = +second.length;
            var i = first.length;
            for (var j = 0; j < len; j++) {
                first[i++] = second[j];
            }
            first.length = i;
            return first;
        },
        // 数组过滤方法
        grep: function grep(elems, callback, invert) {
            var matches = [];
            var callbackExpect = !invert;
            for (var i = 0, length = elems.length; i < length; i++) {
                if (callbackExpect !== !callback(elems[i], i)) {
                    matches.push(elems[i]);
                }
            }
            return matches;
        },
        each: function each(obj, callback) {
            var length,
                i = 0;
            if (isArrayLike(obj)) {
                length = obj.length;
                for (; i < length; i++) {
                    if (callback(obj[i], i) === false) {
                        break;
                    }
                }
            } else {
                for (i in obj) {
                    if (callback(obj[i], i) === false) {
                        break;
                    }
                }
            }
            return obj;
        },
        // 转换为数组的方法
        makeArray: function makeArray(arr, results) {
            var ret = results || [];
            if (arr != null) {
                if (isArrayLike(Object(arr))) {
                    // 处理类数组对象和字符串
                    PuSetFactory.merge(ret, TYPES.String === _typeof(arr) ? [arr] : arr);
                } else {
                    // 处理单个元素
                    push.call(ret, arr);
                }
            }
            return ret;
        },
        /**
         * 下载单个文件
         * @param {string|blob} url 文件数据
         * @param {string} filename 文件名
         */
        download: function download(url) {
            var filename = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "filename";
            var save_link = document.createElementNS("http://www.w3.org/1999/xhtml", "a");
            save_link.href = url;
            save_link.download = filename;
            save_link.dispatchEvent(new MouseEvent("click", {
                "view": window,
                "bubbles": true,
                "cancelable": true
            }));
        },
        /**
         * ES2017+ support
         * @param {String} base64 data URL
         */
        base64ToBlob: function base64ToBlob(base64) {
            // 1. 严格参数校验：确保输入是有效非空字符串
            if (typeof base64 !== 'string' || base64.trim() === '') {
                console.warn('base64ToBlob: 输入必须是非空字符串');
                return null;
            }
            try {
                // 2. 提取正则表达式为常量，提升可维护性
                // 输出示例：data:text/plain;base64,aGVsbG8gd29ybGQ=
                var dataUrlPattern = /^data:([\w\/]+?);base64,(.+)$/;
                // 匹配base64数据URL格式（MIME类型 + 编码内容）
                var matchResult = base64.match(dataUrlPattern);

                // 3. 严谨校验匹配结果，确保格式完整
                if (matchResult === null || matchResult.length < 3) {
                    console.warn('base64ToBlob: 输入不是有效的base64数据URL格式');
                    return null;
                }

                // 4. 解构赋值，提升代码可读性
                var _matchResult = _slicedToArray(matchResult, 3),
                    mimeType = _matchResult[1],
                    base64Data = _matchResult[2];

                // 5. 性能优化：简化Uint8Array转换逻辑（减少冗余数组操作）
                var decodedStr = atob(base64Data); // 解码base64字符串
                var byteLength = decodedStr.length;
                var uint8Array = new Uint8Array(byteLength);

                // 直接遍历字符串赋值，替代 Array.from + map 的冗余转换
                for (var i = 0; i < byteLength; i++) {
                    uint8Array[i] = decodedStr.charCodeAt(i);
                }

                // 6. 创建并返回Blob对象
                return new Blob([uint8Array], {
                    type: mimeType
                });
            } catch (error) {
                // 7. 全局异常捕获，避免程序崩溃
                console.error('base64ToBlob 转换失败:', error);
                return null;
            }
        }
    });

    // DOM就绪状态管理的Promise
    var readyPromise = new Promise(function (resolve) {
        // DOM就绪检测完成回调
        function completed() {
            document.removeEventListener("DOMContentLoaded", completed);
            window.removeEventListener("load", completed);
            resolve();
        }

        // 检查文档是否已经就绪
        if (document.readyState === "complete" || document.readyState !== "loading" && !document.documentElement.doScroll) {
            // 异步处理以确保脚本有机会延迟ready
            window.setTimeout(resolve);
        } else {
            // 添加事件监听
            document.addEventListener("DOMContentLoaded", completed);
            window.addEventListener("load", completed);
        }
    }).then(function () {
        // 设置就绪状态标志
        PuSetFactory.isReady = returnTrue;
    });
    var rnothtmlwhite = /[^\x20\t\r\n\f]+/g;
    var rtypenamespace = /^([^.]*)(?:\.(.+)|)/;
    var expando = Symbol("puset_event_data");
    /**
     * 确保对象具有指定属性，如果不存在则创建默认值
     * @param {Object} target - 目标对象
     * @param {string|symbol} property - 属性名
     * @param {Function} Constructor - 默认值构造函数，默认值为 Object
     * @returns {*} 属性值，如果对象不可扩展则返回 null
     */
    var ensureObjectProperty = function ensureObjectProperty(target, property) {
        var Constructor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Object;
        // 检查对象自身是否具有某个属性，不包括原型链上
        if (Object.hasOwn(target, property)) {
            return target[property];
        }

        // 判断对象是否可以扩展属性
        if (Object.isExtensible(target)) {
            return target[property] = new Constructor();
        }
        return null;
    };

    // 检查浏览器是否支持Element.prototype.matches方法
    var hasMatches = "function" === typeof Element.prototype.matches;

    // 检查浏览器是否支持Element.prototype.closest方法
    var hasClosest = "function" === typeof Element.prototype.closest;

    /**
     * 创建自定义匹配函数，用于判断元素是否匹配选择器
     * @param {Node} target 
     * @param {String} selector 
     * @returns {(item:Node) => Boolean}
     */
    var customMatches = function customMatches(target, selector) {
        if (!selector) return returnFalse;

        // 如果支持matches方法，则直接使用它
        if (hasMatches) return function (item) {
            return item !== target && item.matches && item.matches(selector);
        };

        // 如果支持closest方法，则直接使用它
        if (hasClosest) return function (item) {
            return item !== target && item.closest && item === item.closest(selector);
        };

        // 备选方案：通过查询所有匹配元素创建集合进行判断
        var children = new Set(target.querySelectorAll(selector));
        return function (item) {
            return item && children.has(item);
        };
    };

    /**
     * 获取事件冒泡路径
     * @param {Node} target 
     * @param {Event} event 
     * @returns {Node[]}
     */
    var getComposedPath = function getComposedPath(target, event) {
        var path = event.composedPath ? event.composedPath() : event.path;
        if (path) {
            return slice.call(path, 0, 1 + indexOf.call(path, target));
        } else {
            var node = event.target,
                _path = [];
            do {
                _path.push(node);
                if (node === target) break;
            } while (node = node.parentNode || node.host);
            return _path;
        }
    };
    var EventSubstitute = {
        // 基础鼠标/焦点类：无冒泡事件 → 可冒泡替代事件
        "focus": "focusin",
        "blur": "focusout",
        "mouseenter": "mouseover",
        "mouseleave": "mouseout",
        "pointerenter": "pointerover",
        "pointerleave": "pointerout",
        // 补充拖拽类（无冒泡 → 可冒泡替代）
        "dragenter": "dragover",
        // dragenter（拖入元素）不冒泡，用dragover（拖拽中）替代
        "dragexit": "dragleave",
        // dragexit（拖离元素）不冒泡，用dragleave替代
        "drop": "dragover",
        // drop（释放拖拽）不冒泡，用dragover兜底监听

        // 补充触摸类（无冒泡 → 可冒泡替代）
        "touchcancel": "touchend",
        // touchcancel（触摸中断）不冒泡，用touchend降级替代
        "touchenter": "touchstart",
        // touchenter（触摸进入）不冒泡，用touchstart替代
        /**
         * 提示不支持无冒泡事件委托的信息
         * @param {string} type - 事件类型
         * @param {boolean} not - 是否为无冒泡事件
         */
        notBubbles: function notBubbles(type, not) {
            if (not) {
                var text = Array.of("不支持无法冒泡的[" + type + "]事件的委托。");
                // 自动匹配补全后的替代事件
                if (Object.hasOwn(EventSubstitute, type)) {
                    text.push("可使用[" + EventSubstitute[type] + "]事件替代。");
                } else {
                    text.push("请改用其他可行方案。");
                }
                console.warn(text.join(""));
            }
        }
    };
    Object.assign(PuSetFactory, {
        /**
         * 创建防抖函数
         * @param {number} wait - 延迟时间（毫秒）
         * @param {Function} handler - 回调函数
         * @returns {(event: Event) => void} - 事件处理函数
         */
        debounce: function debounce(wait, handler) {
            var timeout;
            return function listener(event) {
                var _this2 = this;
                clearTimeout(timeout);
                timeout = setTimeout(function () {
                    return handler.call(_this2, event, listener);
                }, wait);
            };
        },
        /**
         * 创建节流函数
         * @param {number} delay 节流的间隔时间（毫秒）
         * @param {Function} handler - 回调函数
         * @returns {(event: Event) => void} - 事件处理函数
         */
        throttle: function throttle(delay, handler) {
            var lastTime = 0;
            return function listener(event) {
                var current = Date.now();
                // 到达间隔时间
                if (current - lastTime >= delay) {
                    handler.call(this, event, listener);
                    lastTime = current; // 更新上次执行时间
                }
            };
        },

        /**
         * 创建事件委托
         * @param {string} selector - 事件代理的子元素选择器
         * @param {(event:Function, listener: (event:Event) => void) => void} handler - 回调函数
         * @returns {(event: Event) => void} - 事件处理函数
         */
        delegation: function delegation(selector, handler) {
            var stringSelector = String(selector);
            // 返回实际的事件监听器
            return function listener(event) {
                var match = getComposedPath(this, event).filter(customMatches(this, stringSelector));
                var length = match.length;
                if (length === 0) {
                    EventSubstitute.notBubbles(event.type, event.bubbles === false);
                    return;
                }
                for (var i = 0; i < length; handler.call(match[i++], event, listener));
            };
        }
    });
    var createListener = function createListener(type, handles) {
        /**
         * 事件委托监听器
         * @param {Event} event
         */
        return handles.listener = function listener(event) {
            var path = null;
            var data = {
                type: type,
                target: this
            };
            var _iterator3 = _createForOfIteratorHelper(handles),
                _step3;
            try {
                for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
                    var handle = _step3.value;
                    // 需要验证命名空间，但验证不通过
                    if (handle.rnamespace && handle.namespace && !handle.rnamespace.test(handle.namespace)) {
                        continue;
                    }
                    var match = handle.selector === null ? [this] // 匹配自身
                        :
                        (path === null ? path = getComposedPath(this, event) : path).filter(customMatches(this, handle.selector)); // 事件托管处理

                    var length = match.length;
                    if (length === 0) {
                        // 检查是否为不可冒泡的事件
                        EventSubstitute.notBubbles(event.type, event.bubbles === false);
                        continue;
                    }
                    var handler = handle.handler;
                    var options = Object.assign({}, handle, data);
                    for (var i = 0; i < length; handler.call(match[i++], event, options));
                }
            } catch (err) {
                _iterator3.e(err);
            } finally {
                _iterator3.f();
            }
        };
    };
    var add = function add(node, types, selector, handler) {
        var data = ensureObjectProperty(node, expando, Object);

        // Only attach events to objects that accept data
        if (data === null) return;
        var t, type, tmp, namespaces;

        // Handle multiple events separated by a space
        types = (types || "").match(rnothtmlwhite) || [""];
        t = types.length;
        while (t--) {
            tmp = rtypenamespace.exec(types[t]) || [];
            type = tmp[1];
            namespaces = (tmp[2] || "").split(".").sort();

            // There *must* be a type, no attaching namespace-only handlers
            if (!type) continue;
            var handles = ensureObjectProperty(data, type, Array);

            // 如果是新添加的事件，则添加到事件列表中
            if (handles.length === 0) {
                var listener = createListener(type, handles);
                if (node.addEventListener) {
                    node.addEventListener(type, listener);
                }
            }
            handles.push({
                selector: selector ? String(selector) : null,
                handler: handler,
                namespace: namespaces.join(".")
            });
        }
    };
    var remove = function remove(node, types, selector, handler) {
        var data = ensureObjectProperty(node, expando, Object);

        // Only attach events to objects that accept data
        if (data === null) return;
        var t, type, tmp, namespaces;

        // Handle multiple events separated by a space
        types = (types || "").match(rnothtmlwhite) || [""];
        t = types.length;
        while (t--) {
            tmp = rtypenamespace.exec(types[t]) || [];
            type = tmp[1];
            namespaces = (tmp[2] || "").split(".").sort();

            // Unbind all events (on this namespace, if provided) for the element
            if (!type) {
                for (type in data) {
                    remove(node, type + types[t], selector, handler);
                }
                continue;
            }
            tmp = tmp[2] && new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)");
            var handles = ensureObjectProperty(data, type, Array);
            var j = handles.length;
            while (j--) {
                var handle = handles[j];
                if ((!tmp || tmp.test(handle.namespace)) && (!selector || selector === handle.selector || selector === "**" && handle.selector) && (!handler || handler === handle.handler)) {
                    handles.splice(j, 1);
                }
            }
            if (handles.length == 0) {
                // 移除事件监听
                if (node.removeEventListener) {
                    node.removeEventListener(type, handles.listener);
                }
                Reflect.deleteProperty(data, type);
            }
        }
    };
    var action = function action(elements, types, selector, callback, method) {
        if ("object" === _typeof(types)) {
            for (var type in types) {
                action(elements, type, selector, types[type], method);
            }
            return elements;
        }
        if ("function" === typeof selector) {
            callback = selector;
            selector = null;
        }
        if (false === callback) {
            callback = returnFalse;
        } else if (!callback) {
            return elements;
        }
        var handler = method === 1 ? function autoremove(event, options) {
            remove(options.target, options.type, options.selector, options.handler);
            return callback.call(this, event, options);
        } : callback;
        var operation = method >= 1 ? add : remove;
        return PuSetFactory.each(elements, function (target) {
            operation(target, types, selector, handler);
        });
    };
    Object.assign(PuSetConstructor.prototype, {
        on: function on(types, selector, callback) {
            return action(this, types, selector, callback, 2);
        },
        one: function one(types, selector, callback) {
            return action(this, types, selector, callback, 1);
        },
        off: function off(types, selector, callback) {
            return action(this, types, selector, callback, 0);
        }
    });

    // /**
    //  * ES2022+
    //  * ViewManager类 - 管理视图与数据的绑定
    //  * 处理数据变化时的视图更新逻辑
    //  */
    // class ViewManager {
    //     selector = "";               // 子元素选择器
    //     children = null;             // 子元素集合
    //     insert = null;               // 新元素插入位置
    //     isInsert = false;            // 是否设置了插入位置
    //     isFunction = false;          // 模板是否为函数类型
    //     hidden = false;              // 初始化后是否隐藏元素
    //     hasLayout = false;           // 是否有自定义布局函数
    //     source = null;               // 原始数据源

    //     /**
    //      * ViewManager构造函数
    //      * @param {Object} options - 配置选项
    //      * @param {HTMLElement} options.target - 指定元素
    //      * @param {string} [options.selector] - 子元素选择器
    //      * @param {HTMLCollection} [options.children] - 子元素集
    //      * @param {string|HTMLElement|Function} [options.template] - 模板
    //      * @param {string|HTMLElement} [options.insert] - 插入位置
    //      * @param {Object|Array} [options.data] - 数据源
    //      * @param {boolean} [options.hidden] - 是否隐藏
    //      * @param {Function} [options.layout] - 布局函数
    //      * @param {Function} [options.onresize] - 数组长度变化回调
    //      */
    //     constructor(options) {
    //         const target = Object.assign(this, options).target;
    //         this.source = this.data ?? {}; // 数据源
    //         this.children = new Map();
    //         const childrenR = this.childrenR = new Map();

    //         // 初始化子元素集
    //         const keys = Object.keys(this.source);
    //         const children = (this.selector) ? target.querySelectorAll(this.selector) : options.children;
    //         PuSet.each(children, (element, index) => this.#set(keys[index] || index, element));

    //         // 设置插入位置
    //         if (this.insert && TYPES.String === typeof this.insert) {
    //             this.insert = target.querySelector(this.insert);
    //         }

    //         this.isInsert = this.insert instanceof HTMLElement;
    //         this.hasLayout = isFunction(this.layout);

    //         const isArray = PuSetFactory.isArray(this.data);
    //         const hasResize = isFunction(this.onresize);
    //         const hasTemplate = this.#initializeTemplate();

    //         /**
    //          * 获取节点参数
    //          * @param {string|number} property - 属性名或索引
    //          * @param {*} value - 属性值
    //          * @returns {Object} - 包含node、index和isLengthProperty的对象
    //          */
    //         const getNodeParams = (property, value) => {
    //             let node = this.target, isLengthProperty = false;
    //             if (hasTemplate) {
    //                 if (isArray) {
    //                     if (LENGTH_PROPERTY === property) {
    //                         isLengthProperty = true;
    //                     } else {
    //                         node = this.#getChild(property, value.type);
    //                         isLengthProperty = false;
    //                     }
    //                 } else {
    //                     node = this.#getChild(property, value.type);
    //                 }
    //             }
    //             return { node, property, isLengthProperty }
    //         };

    //         const data = this.data = new Proxy(this.source, {

    //             /**
    //              * 设置属性拦截器
    //              * @param {Object} target - 目标对象
    //              * @param {string|number} property - 属性名或索引
    //              * @param {*} value - 属性值
    //              * @param {Object} receiver - 接收者
    //              * @returns {boolean} - 操作结果
    //              */
    //             set: (target, property, value, receiver) => {
    //                 try {
    //                     // 使用requestAnimationFrame优化UI更新性能
    //                     requestAnimationFrame(() => {
    //                         const params = getNodeParams(property, value);
    //                         if (params.isLengthProperty) {
    //                             // 处理数组长度变化
    //                             for (let length = this.children.size, i = value; i < length; i++) {
    //                                 PuSetFactory.show(this.children.get(String(i)), false); // 隐藏溢出的元素
    //                             }
    //                             if (hasResize) {
    //                                 this.onresize(this.target, value, property); // 调用长度变化回调
    //                             }
    //                         } else {
    //                             PuSetFactory.show(params.node, true); // 显示元素
    //                             if (this.hasLayout) {
    //                                 // 使用自定义布局函数更新视图
    //                                 this.layout(params.node, value, property);
    //                             }
    //                         }
    //                     });
    //                 } catch (error) {
    //                     console.error(error.message, this);
    //                 } finally {
    //                     return Reflect.set(target, property, value, receiver);
    //                 }
    //             },

    //             /**
    //              * 删除属性拦截器
    //              * @param {Object} target - 目标对象
    //              * @param {string|number} property - 属性名或索引
    //              * @returns {boolean} - 操作结果
    //              */
    //             deleteProperty: (target, property) => {
    //                 PuSetFactory.show(this.children.get(String(property)), false); // 隐藏被删除的元素
    //                 return Reflect.deleteProperty(target, property);
    //             }
    //         }); // 创建数据代理

    //         // 注册事件委托
    //         PuSetFactory.each(this.delegation, function (fn, types) {
    //             PuSetFactory.each((types || "").match(rnothtmlwhite) || [""], function (type) {
    //                 if (type) target.addEventListener(type, function (event) {
    //                     const path = getComposedPath(target, event);
    //                     for (const item of path) {
    //                         // 通过元素反向查找对应的key
    //                         if (childrenR.has(item)) {
    //                             const key = childrenR.get(item);
    //                             fn.call(item, event, data[key], key);
    //                             break;
    //                         }
    //                     }
    //                 });
    //             });
    //         });

    //         if (!this.hidden) {
    //             this.update(this.source); // 初始化视图
    //         }

    //         if (isArray && hasResize) {
    //             // 调用数组长度变化回调
    //             this.onresize(this.target, this.data[LENGTH_PROPERTY], LENGTH_PROPERTY);
    //         }
    //     }

    //     #set(key, value) {
    //         this.children.set(key, value);
    //         this.childrenR.set(value, key);
    //     }

    //     /**
    //      * 初始化模板
    //      * @returns {boolean} - 模板是否有效
    //      */
    //     #initializeTemplate() {
    //         if (this.isFunction = isFunction(this.template)) {
    //             return true; // 模板是函数类型
    //         } else {
    //             const div = document.createElement("div");
    //             if (TYPES.String === typeof this.template) {
    //                 // 从HTML字符串创建模板
    //                 div.innerHTML = this.template;
    //                 this.template = div.firstChild;
    //             } else if (!this.template) {
    //                 // 使用第一个子元素作为模板
    //                 const firstKey = this.children.keys().next().value;
    //                 this.template = this.children.get(firstKey);
    //             }
    //             if (this.template instanceof HTMLElement) {
    //                 this.template = this.template.cloneNode(true); // 克隆模板
    //                 return true;
    //             } else {
    //                 this.template = div.cloneNode(true); // 使用空div作为模板
    //             }
    //         }
    //         return false;
    //     }

    //     /**
    //      * 获取模板实例
    //      * @param {number} index - 位置索引
    //      * @param {string} type - 类型
    //      * @returns {Element|ShadowRoot} - 模板实例
    //      */
    //     #getTemplateInstance(index, type) {
    //         return this.isFunction ? this.template(index, type) : this.template.cloneNode(true);
    //     }

    //     /**
    //      * 获取子元素，超出范围则创建新实例
    //      * @param {number} index - 位置索引
    //      * @param {string} type - 类型
    //      * @returns {Element} - 子元素
    //      */
    //     #getChild(index, type) {
    //         const key = String(index);
    //         let child = this.children.get(key);
    //         if (!child) {
    //             // 创建新的子元素实例
    //             this.#set(key, child = this.#getTemplateInstance(index, type)); // 添加到Map中
    //             if (this.isInsert) {
    //                 this.target.insertBefore(child, this.insert); // 插入到指定位置
    //             } else {
    //                 this.target.appendChild(child); // 添加到末尾
    //             }
    //         }
    //         return child;
    //     }

    //     /**
    //      * 更新数据
    //      * @param {Object|Array} data - 新数据
    //      */
    //     update(data) {
    //         Object.assign(this.data, data); // 使用代理对象更新数据
    //     }
    // };

    /**
     * 优化后的 ViewManager 类 - 管理视图与数据的绑定
     * 处理数据变化时的视图更新逻辑
     */
    var _children = /*#__PURE__*/ new WeakMap();
    var _childrenReverse = /*#__PURE__*/ new WeakMap();
    var _isInsert = /*#__PURE__*/ new WeakMap();
    var _isFunctionTemplate = /*#__PURE__*/ new WeakMap();
    var _hasLayout = /*#__PURE__*/ new WeakMap();
    var _hasResize = /*#__PURE__*/ new WeakMap();
    var _isArrayData = /*#__PURE__*/ new WeakMap();
    var _initializeOptions = /*#__PURE__*/ new WeakSet();
    var _initializeChildren = /*#__PURE__*/ new WeakSet();
    var _initializeTemplate = /*#__PURE__*/ new WeakSet();
    var _initializeDataProxy = /*#__PURE__*/ new WeakSet();
    var _handleDataChange = /*#__PURE__*/ new WeakSet();
    var _handleLengthChange = /*#__PURE__*/ new WeakSet();
    var _handlePropertyChange = /*#__PURE__*/ new WeakSet();
    var _handleDataDelete = /*#__PURE__*/ new WeakSet();
    var _initializeEventDelegation = /*#__PURE__*/ new WeakSet();
    var _getNodeParams = /*#__PURE__*/ new WeakSet();
    var _hasTemplate = /*#__PURE__*/ new WeakSet();
    var _setChild = /*#__PURE__*/ new WeakSet();
    var _getTemplateInstance = /*#__PURE__*/ new WeakSet();
    var _getChild = /*#__PURE__*/ new WeakSet();
    var _insertChild = /*#__PURE__*/ new WeakSet();
    var ViewManager = /*#__PURE__*/ function () {
        // 私有字段
        // 子元素映射 (key -> element)
        // 反向映射 (element -> key)
        // 是否设置了插入位置
        // 模板是否为函数类型
        // 是否有自定义布局函数
        // 是否有尺寸变化回调
        // 数据是否为数组类型

        // 配置选项
        // 子元素选择器
        // 新元素插入位置
        // 初始化后是否隐藏元素
        // 原始数据源
        // 代理数据对象
        // 目标容器元素
        // 模板配置
        // 布局函数
        // 数组长度变化回调
        // 事件委托配置

        /**
         * ViewManager构造函数
         * @param {Object} options - 配置选项
         */
        function ViewManager(_options) {
            _classCallCheck(this, ViewManager);
            /**
             * 插入子元素
             */
            _classPrivateMethodInitSpec(this, _insertChild);
            /**
             * 获取或创建子元素
             */
            _classPrivateMethodInitSpec(this, _getChild);
            /**
             * 获取模板实例
             */
            _classPrivateMethodInitSpec(this, _getTemplateInstance);
            /**
             * 设置子元素映射
             */
            _classPrivateMethodInitSpec(this, _setChild);
            /**
             * 检查是否有有效模板
             */
            _classPrivateMethodInitSpec(this, _hasTemplate);
            /**
             * 获取节点参数
             */
            _classPrivateMethodInitSpec(this, _getNodeParams);
            /**
             * 初始化事件委托
             */
            _classPrivateMethodInitSpec(this, _initializeEventDelegation);
            /**
             * 处理数据删除
             */
            _classPrivateMethodInitSpec(this, _handleDataDelete);
            /**
             * 处理属性变化
             */
            _classPrivateMethodInitSpec(this, _handlePropertyChange);
            /**
             * 处理数组长度变化
             */
            _classPrivateMethodInitSpec(this, _handleLengthChange);
            /**
             * 处理数据变化
             */
            _classPrivateMethodInitSpec(this, _handleDataChange);
            /**
             * 初始化数据代理
             */
            _classPrivateMethodInitSpec(this, _initializeDataProxy);
            /**
             * 初始化模板配置
             */
            _classPrivateMethodInitSpec(this, _initializeTemplate);
            /**
             * 初始化子元素集合
             */
            _classPrivateMethodInitSpec(this, _initializeChildren);
            /**
             * 初始化配置选项
             * @param {Object} options - 配置选项
             */
            _classPrivateMethodInitSpec(this, _initializeOptions);
            _classPrivateFieldInitSpec(this, _children, {
                writable: true,
                value: new Map()
            });
            _classPrivateFieldInitSpec(this, _childrenReverse, {
                writable: true,
                value: new Map()
            });
            _classPrivateFieldInitSpec(this, _isInsert, {
                writable: true,
                value: false
            });
            _classPrivateFieldInitSpec(this, _isFunctionTemplate, {
                writable: true,
                value: false
            });
            _classPrivateFieldInitSpec(this, _hasLayout, {
                writable: true,
                value: false
            });
            _classPrivateFieldInitSpec(this, _hasResize, {
                writable: true,
                value: false
            });
            _classPrivateFieldInitSpec(this, _isArrayData, {
                writable: true,
                value: false
            });
            _defineProperty(this, "selector", "");
            _defineProperty(this, "insert", null);
            _defineProperty(this, "hidden", false);
            _defineProperty(this, "source", null);
            _defineProperty(this, "data", null);
            _defineProperty(this, "target", null);
            _defineProperty(this, "template", null);
            _defineProperty(this, "layout", null);
            _defineProperty(this, "onresize", null);
            _defineProperty(this, "delegation", {});
            _classPrivateMethodGet(this, _initializeOptions, _initializeOptions2).call(this, _options);
            _classPrivateMethodGet(this, _initializeChildren, _initializeChildren2).call(this);
            _classPrivateMethodGet(this, _initializeTemplate, _initializeTemplate2).call(this);
            _classPrivateMethodGet(this, _initializeDataProxy, _initializeDataProxy2).call(this);
            _classPrivateMethodGet(this, _initializeEventDelegation, _initializeEventDelegation2).call(this);
            if (!this.hidden) {
                this.update(this.source);
            }
            if (_classPrivateFieldGet(this, _isArrayData) && _classPrivateFieldGet(this, _hasResize)) {
                this.onresize(this.target, this.data.length, 'length');
            }
        }
        _createClass(ViewManager, [{
            key: "update",
            value:
                /**
                 * 更新数据
                 * @param {Object|Array} newData - 新数据
                 */
                function update(newData) {
                    Object.assign(this.data, newData);
                }

            /**
             * 获取子元素数量
             */
        }, {
            key: "childCount",
            get: function get() {
                return _classPrivateFieldGet(this, _children).size;
            }

            /**
             * 销毁实例，清理资源
             */
        }, {
            key: "destroy",
            value: function destroy() {
                _classPrivateFieldGet(this, _children).clear();
                _classPrivateFieldGet(this, _childrenReverse).clear();
                this.data = null;
                this.target = null;
            }
        }]);
        return ViewManager;
    }(); // 更新工厂函数
    function _initializeOptions2(options) {
        var _this$data;
        Object.assign(this, options);
        this.source = (_this$data = this.data) !== null && _this$data !== void 0 ? _this$data : {};
        _classPrivateFieldSet(this, _isArrayData, PuSetFactory.isArray(this.data));
        _classPrivateFieldSet(this, _hasLayout, isFunction(this.layout));
        _classPrivateFieldSet(this, _hasResize, isFunction(this.onresize));
    }

    function _initializeChildren2() {
        var _this3 = this;
        var keys = Object.keys(this.source);
        var children = this.selector ? this.target.querySelectorAll(this.selector) : this.children;
        PuSetFactory.each(children, function (element, index) {
            _classPrivateMethodGet(_this3, _setChild, _setChild2).call(_this3, keys[index] || index, element);
        });

        // 设置插入位置
        if (this.insert && typeof this.insert === 'string') {
            this.insert = this.target.querySelector(this.insert);
        }
        _classPrivateFieldSet(this, _isInsert, this.insert instanceof HTMLElement);
    }

    function _initializeTemplate2() {
        if (isFunction(this.template)) {
            _classPrivateFieldSet(this, _isFunctionTemplate, true);
            return;
        }
        var div = document.createElement('div');
        if (typeof this.template === 'string') {
            div.innerHTML = this.template;
            this.template = div.firstElementChild;
        } else if (!this.template) {
            // 使用第一个子元素作为模板
            var firstKey = _classPrivateFieldGet(this, _children).keys().next().value;
            this.template = _classPrivateFieldGet(this, _children).get(firstKey);
        }
        if (this.template instanceof HTMLElement) {
            this.template = this.template.cloneNode(true);
        } else {
            this.template = div.cloneNode(true);
        }
    }

    function _initializeDataProxy2() {
        var _this4 = this;
        this.data = new Proxy(this.source, {
            set: function set(target, property, value, receiver) {
                _classPrivateMethodGet(_this4, _handleDataChange, _handleDataChange2).call(_this4, target, property, value, receiver);
                return Reflect.set(target, property, value, receiver);
            },
            deleteProperty: function deleteProperty(target, property) {
                _classPrivateMethodGet(_this4, _handleDataDelete, _handleDataDelete2).call(_this4, target, property);
                return Reflect.deleteProperty(target, property);
            }
        });
    }

    function _handleDataChange2(target, property, value, receiver) {
        var _this5 = this;
        requestAnimationFrame(function () {
            var params = _classPrivateMethodGet(_this5, _getNodeParams, _getNodeParams2).call(_this5, property, value);
            if (params.isLengthProperty) {
                _classPrivateMethodGet(_this5, _handleLengthChange, _handleLengthChange2).call(_this5, value);
            } else {
                _classPrivateMethodGet(_this5, _handlePropertyChange, _handlePropertyChange2).call(_this5, params.node, value, property);
            }
        });
    }

    function _handleLengthChange2(newLength) {
        // 隐藏超出新长度的元素
        for (var i = newLength; i < _classPrivateFieldGet(this, _children).size; i++) {
            PuSetFactory.show(_classPrivateFieldGet(this, _children).get(i), false);
        }
        if (_classPrivateFieldGet(this, _hasResize)) {
            this.onresize(this.target, newLength, 'length');
        }
    }

    function _handlePropertyChange2(node, value, property) {
        PuSetFactory.show(node, true);
        if (_classPrivateFieldGet(this, _hasLayout)) {
            this.layout(node, value, property);
        }
    }

    function _handleDataDelete2(target, property) {
        PuSetFactory.show(_classPrivateFieldGet(this, _children).get(property), false);
    }

    function _initializeEventDelegation2() {
        var _this6 = this;
        PuSetFactory.each(this.delegation, function (fn, types) {
            PuSetFactory.each((types || '').match(rnothtmlwhite) || [''], function (type) {
                if (!type) return;
                _this6.target.addEventListener(type, function (event) {
                    var path = getComposedPath(_this6.target, event);
                    var _iterator7 = _createForOfIteratorHelper(path),
                        _step7;
                    try {
                        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
                            var item = _step7.value;
                            if (_classPrivateFieldGet(_this6, _childrenReverse).has(item)) {
                                var key = _classPrivateFieldGet(_this6, _childrenReverse).get(item);
                                fn.call(item, event, _this6.data[key], key);
                            }
                        }
                    } catch (err) {
                        _iterator7.e(err);
                    } finally {
                        _iterator7.f();
                    }
                });
            });
        });
    }

    function _getNodeParams2(property, value) {
        var node = this.target;
        var isLengthProperty = false;
        if (_classPrivateMethodGet(this, _hasTemplate, _hasTemplate2).call(this)) {
            if (_classPrivateFieldGet(this, _isArrayData)) {
                if (property === 'length') {
                    isLengthProperty = true;
                } else {
                    node = _classPrivateMethodGet(this, _getChild, _getChild2).call(this, property, value === null || value === void 0 ? void 0 : value.type);
                }
            } else {
                node = _classPrivateMethodGet(this, _getChild, _getChild2).call(this, property, value === null || value === void 0 ? void 0 : value.type);
            }
        }
        return {
            node: node,
            property: property,
            isLengthProperty: isLengthProperty
        };
    }

    function _hasTemplate2() {
        return _classPrivateFieldGet(this, _isFunctionTemplate) || this.template instanceof HTMLElement;
    }

    function _setChild2(key, element) {
        _classPrivateFieldGet(this, _children).set(key, element);
        _classPrivateFieldGet(this, _childrenReverse).set(element, key);
    }

    function _getTemplateInstance2(index, type) {
        return _classPrivateFieldGet(this, _isFunctionTemplate) ? this.template(index, type) : this.template.cloneNode(true);
    }

    function _getChild2(index, type) {
        var key = String(index);
        var child = _classPrivateFieldGet(this, _children).get(key);
        if (!child) {
            child = _classPrivateMethodGet(this, _getTemplateInstance, _getTemplateInstance2).call(this, index, type);
            _classPrivateMethodGet(this, _setChild, _setChild2).call(this, key, child);
            _classPrivateMethodGet(this, _insertChild, _insertChild2).call(this, child);
        }
        return child;
    }

    function _insertChild2(child) {
        if (_classPrivateFieldGet(this, _isInsert)) {
            this.target.insertBefore(child, this.insert);
        } else {
            this.target.appendChild(child);
        }
    }
    PuSetFactory.ViewManager = function (options) {
        return new ViewManager(options);
    };
    PuSetFactory.each({
        "HTML": "text/html",
        "XHTML": "application/xhtml+xml",
        "XML": "application/xml",
        "SVG": "image/svg+xml"
    }, function (mimetype, name) {
        // ES2009+
        PuSetFactory["parse" + name] = function (text) {
            return new window.DOMParser().parseFromString(text, mimetype);
        };
    });

    // 模板和组件化

    var HOST_CLASS_NAME = "template-layer-host";
    var DEFAULT_NAME = "default"; // 默认名称
    var HEAD_STYLE = new Set();

    /**
     * ViewComponent 类 - 表示一个视图模板
     * 管理模板的DOM结构、样式和初始化逻辑
     */
    var ViewComponent = /*#__PURE__*/ function () {
        // 视图命名空间
        // 视图名称
        // 视图长名称
        // 视图初始化执行函数
        // 视图样式
        // 缓存的DOM元素

        /**
         * View构造函数
         * @param {string} name - 视图名称
         * @param {Node[]} nodes - 视图节点
         * @param {HTMLStyleElement} style - 视图样式
         * @param {Function} handler - 视图初始化处理函数
         */
        function ViewComponent(namespace, name, nodes, style, handler) {
            _classCallCheck(this, ViewComponent);
            _defineProperty(this, "namespace", DEFAULT_NAME);
            _defineProperty(this, "name", "");
            _defineProperty(this, "longName", "");
            _defineProperty(this, "exec", returnFalse);
            _defineProperty(this, "styleNode", null);
            _defineProperty(this, "cachedElements", null);
            this.namespace = namespace;
            this.name = name;
            this.longName = ["puset", namespace, name].join("-");
            this.styleNode = style;
            this.cachedElements = nodes;
            this.exec = isFunction(handler) ? handler : returnFalse;
            if (style) {
                var className = this.longName;
                // 维护头部样式，避免重复添加
                if (HEAD_STYLE.has(className)) {
                    console.warn("重复添加样式：", className);
                    return;
                }
                var style2 = document.createElement("style");
                HEAD_STYLE.add(style2.id = className);
                // 添加样式，使用原生支持的 CSS嵌套方案，限制样式作用域
                style2.textContent = ".".concat(className, " { ").concat(style.textContent, " }");
                document.head.appendChild(style2);
            }
        }

        /**
         * 初始化视图
         * @param {HTMLElement} [container] - 根元素
         * @param {Boolean} [isRootDOM] - 非 Shadow 模式
         * @param {Function} handler - 初始化回调函数，接收root和view参数
         * @returns {ShadowRoot} - 返回Shadow DOM根节点
         */
        _createClass(ViewComponent, [{
            key: "init",
            value: function init() {
                var params = {};
                for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
                    args[_key2] = arguments[_key2];
                }
                for (var _i2 = 0, _args = args; _i2 < _args.length; _i2++) {
                    var arg = _args[_i2];
                    params[_typeof(arg)] = arg;
                }
                var container = params.object,
                    isRootDOM = params["boolean"],
                    handler = params["function"];
                var clone = container ? container : document.createElement("div");
                if (clone.nodeType !== Node.ELEMENT_NODE) {
                    throw new TypeError("Invalid container");
                }
                var root = isRootDOM ? clone : clone.attachShadow({
                    mode: "open"
                });
                clone.classList.add(HOST_CLASS_NAME, this.longName);
                if (!isRootDOM && this.styleNode) {
                    root.appendChild(this.styleNode.cloneNode(true));
                }

                // 克隆缓存的元素并添加到 root
                var _iterator4 = _createForOfIteratorHelper(this.cachedElements),
                    _step4;
                try {
                    for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
                        var node = _step4.value;
                        root.appendChild(node.cloneNode(true));
                    }

                    // 执行初始化回调
                } catch (err) {
                    _iterator4.e(err);
                } finally {
                    _iterator4.f();
                }
                if (isFunction(handler)) handler(root, this);
                return root;
            }
        }]);
        return ViewComponent;
    }();
    /**
     * Components
     * 模板实例管理器
     * 使用双层Map存储所有模板实例，外层为命名空间，内层为该命名空间下的模板
     */
    var TEMPLATE_INSTANCES = new Map();
    var DEFAULT_ViewComponent = new ViewComponent(DEFAULT_NAME, DEFAULT_NAME, document.createElement("div"));
    /**
     * 获取指定命名空间的模板Map，如果不存在则创建
     * @param {string} namespace - 命名空间
     * @returns {Map} - 模板Map
     */
    var getNamespaceMap = function getNamespaceMap() {
        var namespace = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NAME;
        if (!TEMPLATE_INSTANCES.has(namespace)) {
            TEMPLATE_INSTANCES.set(namespace, new Map());
        }
        return TEMPLATE_INSTANCES.get(namespace);
    };
    getNamespaceMap(DEFAULT_NAME).set(DEFAULT_NAME, DEFAULT_ViewComponent);
    Object.assign(PuSetFactory, {
        /**
         * 获取模板
         * @param {string} name - 模板名称
         * @param {string} [namespace] - 命名空间，可选
         * @returns {ViewComponent} - 模板实例
         */
        get: function get() {
            var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NAME;
            var namespace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_NAME;
            var namespaceMap = getNamespaceMap(namespace);
            return namespaceMap.has(name) ? namespaceMap.get(name) : DEFAULT_ViewComponent;
        },
        /**
         * 获取所有已存在的命名空间
         * @returns {string[]} - 命名空间数组
         */
        getNamespaces: function getNamespaces() {
            return Array.from(TEMPLATE_INSTANCES.keys());
        },
        /**
         * 删除指定命名空间
         * @param {string} [namespace=DEFAULT_NAMESPACE] - 要删除的命名空间
         * @returns {boolean} - 是否删除成功
         */
        removeNamespace: function removeNamespace() {
            var namespace = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NAME;
            // 保护默认命名空间不被删除
            if (namespace === DEFAULT_NAME) return false;
            return TEMPLATE_INSTANCES["delete"](namespace);
        },
        /**
         * 获取指定命名空间下的所有模板
         * @param {string} [namespace=DEFAULT_NAMESPACE] - 命名空间
         * @returns {string[]} - 模板数组
         */
        getTemplates: function getTemplates() {
            var namespace = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_NAME;
            return TEMPLATE_INSTANCES.has(namespace) ? Array.from(TEMPLATE_INSTANCES.get(namespace).keys()) : null;
        },
        /**
         * ES2017+
         * 从URL加载模板到指定命名空间
         * 模板文件应包含id为"puset-interpreter-template"的元素，其后的template元素将被加载
         * @param {string} url - 模板文件URL（必须同源）
         * @param {string} [namespace=DEFAULT_NAMESPACE] - 命名空间
         * @returns {Promise<NodeList>} - 包含模板节点的Promise
         * @warning 会执行模板中的脚本，建议仅加载可信来源的模板
         */
        load: function load(url) {
            var _arguments = arguments;
            return _asyncToGenerator( /*#__PURE__*/ _regeneratorRuntime().mark(function _callee() {
                var namespace, testURL, response, text, nodeList, funcName, namespaceMap, _iterator5, _step5, node, id, $elements, _iterator6, _step6, child, style, script, handler;
                return _regeneratorRuntime().wrap(function _callee$(_context) {
                    while (1) switch (_context.prev = _context.next) {
                        case 0:
                            namespace = _arguments.length > 1 && _arguments[1] !== undefined ? _arguments[1] : DEFAULT_NAME;
                            // 验证URL
                            testURL = new URL(url, window.location.href);
                            if (!(testURL.origin !== window.location.origin)) {
                                _context.next = 4;
                                break;
                            }
                            throw new Error("同源策略限制：不允许跨域加载资源");
                        case 4:
                            _context.next = 6;
                            return fetch(testURL.href);
                        case 6:
                            response = _context.sent;
                            if (response.ok) {
                                _context.next = 9;
                                break;
                            }
                            throw new Error("HTTP\u8BF7\u6C42\u5931\u8D25\uFF1A".concat(response.status, " ").concat(response.statusText));
                        case 9:
                            _context.next = 11;
                            return response.text();
                        case 11:
                            text = _context.sent;
                            // 解析HTML文本
                            nodeList = PuSetFactory("hr#puset-interpreter-template~template", PuSetFactory.parseHTML(text)); // 检查是否找到模板
                            if (!(nodeList.length === 0)) {
                                _context.next = 15;
                                break;
                            }
                            throw new Error("未找到有效的模板元素");
                        case 15:
                            funcName = PuSetFactory.name;
                            namespaceMap = getNamespaceMap(namespace); // 处理每个模板，分别只取最后一个style, node，script
                            _iterator5 = _createForOfIteratorHelper(nodeList);
                            _context.prev = 18;
                            _iterator5.s();
                        case 20:
                            if ((_step5 = _iterator5.n()).done) {
                                _context.next = 59;
                                break;
                            }
                            node = _step5.value;
                            id = node.id;
                            if (id) {
                                _context.next = 26;
                                break;
                            }
                            console.warn("已跳过未命名模板");
                            return _context.abrupt("continue", 57);
                        case 26:
                            $elements = new PuSetConstructor(); // 分类处理模板中的子元素
                            _iterator6 = _createForOfIteratorHelper(node.content.children);
                            _context.prev = 28;
                            _iterator6.s();
                        case 30:
                            if ((_step6 = _iterator6.n()).done) {
                                _context.next = 42;
                                break;
                            }
                            child = _step6.value;
                            _context.t0 = child.nodeName.toLowerCase();
                            _context.next = _context.t0 === "style" ? 35 : _context.t0 === "script" ? 37 : 39;
                            break;
                        case 35:
                            $elements.style = child;
                            return _context.abrupt("break", 40);
                        case 37:
                            $elements.script = child;
                            return _context.abrupt("break", 40);
                        case 39:
                            $elements.push(child);
                        case 40:
                            _context.next = 30;
                            break;
                        case 42:
                            _context.next = 47;
                            break;
                        case 44:
                            _context.prev = 44;
                            _context.t1 = _context["catch"](28);
                            _iterator6.e(_context.t1);
                        case 47:
                            _context.prev = 47;
                            _iterator6.f();
                            return _context.finish(47);
                        case 50:
                            style = $elements.style, script = $elements.script; // 验证视图元素
                            if ($elements.length) {
                                _context.next = 54;
                                break;
                            }
                            console.warn("\u6A21\u677F ".concat(id, " \u7F3A\u5C11\u89C6\u56FE\u5143\u7D20\uFF0C\u5DF2\u8DF3\u8FC7"));
                            return _context.abrupt("continue", 57);
                        case 54:
                            //  else if ($elements.find("script").length) {
                            //     console.warn(`模板 ${node.id || "[未命名]"} 中包含脚本元素，已跳过`);
                            //     continue;
                            // }
                            // 处理脚本
                            handler = returnFalse;
                            if (script && script.innerText) {
                                try {
                                    // 执行模板中的脚本，传入PuSetFactory作为参数
                                    handler = new Function(funcName, script.innerText).call($elements, PuSetFactory);
                                } catch (err) {
                                    console.error("\u6267\u884C\u6A21\u677F ".concat(id, " \u811A\u672C\u65F6\u51FA\u9519:"), err);
                                    // 可以选择跳过当前模板或使用默认处理器
                                    handler = returnFalse;
                                }
                            }

                            // 注册模板到指定命名空间
                            namespaceMap.set(id, new ViewComponent(namespace, id, $elements, style, handler));
                        case 57:
                            _context.next = 20;
                            break;
                        case 59:
                            _context.next = 64;
                            break;
                        case 61:
                            _context.prev = 61;
                            _context.t2 = _context["catch"](18);
                            _iterator5.e(_context.t2);
                        case 64:
                            _context.prev = 64;
                            _iterator5.f();
                            return _context.finish(64);
                        case 67:
                            return _context.abrupt("return", nodeList);
                        case 68:
                        case "end":
                            return _context.stop();
                    }
                }, _callee, null, [
                    [18, 61, 64, 67],
                    [28, 44, 47, 50]
                ]);
            }))();
        }
    });
    return PuSetFactory;
}();